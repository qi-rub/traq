Contributing
============

1. `hpack` to regenerate the `.cabal` configuration (from `package.yaml`).
2. Tests are written using [`hspec`](https://hackage.haskell.org/package/hspec), in `test/`.
3. Formatting: [`formolu`](https://fourmolu.github.io/).

Design
------

### Lenses

For (deeply nested) data-structures, we manually write classy lenses to support access/updates, similar to ones generated by [microlens-th](https://hackage-content.haskell.org/package/microlens-th-0.4.3.17).

Here is an example: 
```haskell
-- | A function context contains a list of functions
type FunCtx primT sizeT = Ctx.Context (FunDef primT sizeT)

class HasFunCtx p where
  -- prefix the lens with an underscore.
  _funCtx :: (primT ~ PrimitiveType p, sizeT ~ SizeType p) => Lens' p (FunCtx primT sizeT)

instance HasFunCtx (FunCtx primT sizeT) where _funCtx = id
```
